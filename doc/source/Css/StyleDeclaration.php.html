<html>
    <head>
        <script
            type="text/javascript"
            src="../../js/jquery-1.4.2.min.js">
        </script>
        <script
            type="text/javascript"
            src="../../syntax_highlighter/scripts/shCore.js">
        </script>
        <script
            type="text/javascript"
            src="../../syntax_highlighter/scripts/shBrushJScript.js">
        </script>
        <script
            type="text/javascript"
            src="../../syntax_highlighter/scripts/shBrushPhp.js">
        </script>
        <script
            type="text/javascript"
            src="../../syntax_highlighter/scripts/shBrushXml.js">
        </script>
        <link
            href="../../syntax_highlighter/styles/shCore.css" rel="stylesheet"
            type="text/css"
        />
        <link
            href="../../syntax_highlighter/styles/shCoreEclipse.css"
            rel="stylesheet" type="text/css"
        />
        <link
            href="../../syntax_highlighter/styles/shThemeWordpress.css"
            rel="stylesheet" type="text/css"
        />
    </head>
    <body>
        <pre class="brush: php">&lt;?php
namespace ju1ius\Css;

/**
 * Represents a Css style declaration
 * @package Css
 **/
class StyleDeclaration implements Serializable
{
  private $properties;
  private $parentRule;

  public function __construct($properties=array())
  {
    $this-&gt;properties = $properties;
  }

  /**
   * Checks if this sule set contains the given property or property name
   *
   * @param ju1ius\Css\Property|string $property The ju1ius\Css\Property or rule name to search for.
   *
   * @return bool
   **/
  public function contains($property)
  {
    if($property instanceof Property)
    {
      return in_array($property, $this-&gt;properties, true);
    }
    foreach($this-&gt;properties as $p)
    {
			if($property === $p-&gt;getName()) return true;
		}
		return false;
	}

  /**
   * Appends a ju1ius\Css\Property to this ju1ius\Css\StyleDeclaration instance
   *
   * @param ju1ius\Css\Property $property The ju1ius\Css\Property to append
   *
   * @return ju1ius\Css\StyleDeclaration The current ju1ius\Css\StyleDeclaration instance
   **/
  public function append(Property $property)
  {
    $this-&gt;properties[] = $property;
    return $this;
	}

  /**
   * Prepends a ju1ius\Css\Property to this ju1ius\Css\StyleDeclaration instance
   *
   * @param ju1ius\Css\Property $property The ju1ius\Css\Property to prepend
   *
   * @return ju1ius\Css\StyleDeclaration The current ju1ius\Css\StyleDeclaration instance
   **/
  public function prepend(Property $property)
  {
    array_unshift($this-&gt;properties, $property);
    return $this;
  }

	/**
	 * Inserts a property or an array of properties after the specified property.
	 *
	 * @param ju1ius\Css\Property|array $newProp The property or array of properties to insert
   * @param ju1ius\Css\Property       $oldProp The ju1ius\Css\Property after which properties will be added.
   *
   * @return ju1ius\Css\StyleDeclaration The current ju1ius\Css\StyleDeclaration instance
	 **/
  public function insertAfter($newProp, Property $oldProp)
  {
    if(!is_array($newProp)) $newProp = array($newProp);
		$index = array_search($oldProp, $this-&gt;properties);
    array_splice($this-&gt;properties, $index, 0, $newProp);
    return $this;
	}

	/**
	 * Inserts a property or an array of rules before the specified property.
	 *
	 * @param ju1ius\Css\Property|array $newProp  The property or array of rules to insert
	 * @param ju1ius\Css\Property       $oldProp  The ju1ius\Css\Property before which rules will be added.
   *
   * @return ju1ius\Css\StyleDeclaration The current ju1ius\Css\StyleDeclaration instance
	 **/
  public function insertBefore($newProp, Property $oldProp)
  {
    if(!is_array($newProp)) $newProp = array($newProp);
		$index = array_search($oldProp, $this-&gt;properties);
    array_splice($this-&gt;properties, $index-1, 0, $newProp);
    return $this;
	}

	/**
	 * Replaces a property by another property or an array of properties.
	 *
	 * @param ju1ius\Css\Property       $oldProp  The ju1ius\Css\Property to replace
	 * @param ju1ius\Css\Property|array $newProp  A ju1ius\Css\Property or an array of rules to add
   *
   * @return ju1ius\Css\StyleDeclaration The current ju1ius\Css\StyleDeclaration instance
	 **/
  public function replace(Property $oldProp, $newProp)
  {
    if(!is_array($newProp)) $newProp = array($newProp);
		$index = array_search($oldProp, $this-&gt;properties);
    array_splice($this-&gt;properties, $index, 1, $newProp);
    return $this;
	}

  /**
   * Removes a property from this StyleDeclaration.
   *
   * @param int|string|ju1ius\Css\Property|array $search An index, ju1ius\Css\Property instance or property name to remove, or an array thereof.
   *                                  If int, removes the property at given position.
   *                                  If ju1ius\Css\Property, removes the specified property.
   *                                  If string, all matching properties will be removed.
   * @param bool           $bWildcard If true, all properties starting with the pattern are returned.
   *                                  If false only properties wich strictly match the pattern.
   **/
  public function remove($search, $wildcard=false)
  {
    if(!is_array($search)) $search = array($search);
    foreach($search as $property) {
      if(is_int($property)) {
        unset($this-&gt;properties[$property]);
      } else if($property instanceof Property) {
        $index = array_search($property, $this-&gt;properties);
        unset($this-&gt;properties[$index]);
      } else {
        foreach($this-&gt;properties as $pos =&gt; $prop) {
          if($wildcard) {
            if(strpos($prop-&gt;getName(), $property) === 0) unset($this-&gt;properties[$pos]);
          } else {
            if($prop-&gt;getName() === $property) unset($this-&gt;properties[$pos]);
          }
        }
      }
    }
    $this-&gt;properties = array_values($this-&gt;properties);
	}

	/**
	 * Get the position of a property in the property set.
	 * @param ju1ius\Css\Property $property The ju1ius\Css\Property to search for.
	 *
	 * @return int The position of the property or false if it is not found; 
	 **/
  public function getPropertyIndex(Property $property)
  {
		return array_search($property, $this-&gt;properties, true);
  }

	/**
   * Returns all properties matching the given property name.
   *
   * @param (null|string|ju1ius\Css\Property) $property     Pattern to search for.
   *                                         If null, returns all rules.
   *                                         If ju1ius\Css\Property, the property name is used for searching.
   * @param bool                  $bWildcard If true, all rules starting with the pattern are returned.
   *                                         If false only rules wich strictly match the pattern.
   *
   * @return array An array of matching properties
   *
	 * @example $styleDeclaration-&gt;getProperties('font', true) //returns an array of all rules beginning with font.
	 * @example $styleDeclaration-&gt;getProperties('font') //returns array([index] =&gt; $property) or empty array().
	 **/
  public function getProperties($property = null, $wildcard=false)
  {
		if(!$property) return $this-&gt;properties;
		if($property instanceof Property) $property = $property-&gt;getName();
		$result = array();
    foreach($this-&gt;properties as $pos =&gt; $prop) {
      if($wildcard) {
				if(strpos($prop-&gt;getName(), $property) === 0) $result[$pos] = $prop;
      } else {
				if($prop-&gt;getName() === $property) $result[$pos] = $prop;
			}
		}
		return $result;
	}

  /**
   * Returns the first property or the first property matching name.
   *
   * @param null|string A property name to match
   *
   * @return ju1ius\Css\Property
   **/
  public function getFirst($property=null)
  {
    if(!$property &amp;&amp; isset($this-&gt;properties[0])) return $this-&gt;properties[0];
    foreach($this-&gt;properties as $prop) {
			if($prop-&gt;getName() === $property) return $prop;
    }
  }

  /**
   * Returns the first property or the first property matching name.
   *
   * @param null|string A property name to match
   *
   * @return ju1ius\Css\Property
   **/
  public function getLast($property=null) {
    if(!$property &amp;&amp; count($this-&gt;properties)) return $this-&gt;properties[count($this-&gt;properties)-1];
    foreach(array_reverse($this-&gt;properties) as $prop) {
			if($prop-&gt;getName() === $property) return $prop;
    }
  }

  public function getAppliedProperties()
  {
    $aProperties = array();
    foreach($this-&gt;properties as $property) {
      $aProperties[$property-&gt;getName()] = null;
    }
    foreach($aProperties as $name =&gt; $dummy) {
      $aProperties[$name] = $this-&gt;getAppliedProperty($name);
    }
    return $aProperties;
  }

  /**
   * Returns the last property matching name, taking !important declaration into account.
   *
   * @param string  $property         A property name
   * @param bool    $withPosition If true return an associative array containing
   *                               the property object and its position.
   *                               If false return the matched property.
   *
   * @return null|ju1ius\Css\Property|array
   **/
  public function getAppliedProperty($property, $withPosition=false)
  {
    $lastImportantProp = array();
    $lastProp = array();
    foreach($this-&gt;properties as $pos =&gt; $prop) {
      if($prop-&gt;getName() == $property) {
        if($prop-&gt;getIsImportant()) {
          $lastImportantProp['position'] = $pos;
          $lastImportantProp['property'] = $prop;
        } else {
          $lastProp['position'] = $pos;
          $lastProp['property'] = $prop;
        }
      }
    }
    if($lastImportantProp) {
      return $withPosition
        ? array($lastImportantProp['position'] =&gt; $lastImportantProp['property'])
        : $lastImportantProp['property'];
    } else if($lastProp) {
      return $withPosition
        ? array($lastProp['position'] =&gt; $lastProp['property'])
        : $lastProp['property'];
    }
  }

  /**
   * Removes all unused duplicate properties
   *
   * @param array $excludes an array of property names to exclude from removal
   *
   * @return $this
   **/
  public function removeUnusedProperties(array $excludes=array())
  {
    $applied_properties = $this-&gt;getAppliedProperties();
    foreach($applied_properties as $applied_property) {
      $name = $applied_property-&gt;getName();
      if(in_array($name, $excludes)) continue;
      $properties = $this-&gt;getProperties($name);
      foreach ($properties as $property) {
        if($property === $applied_property) continue;
        $this-&gt;remove($property);
      }
    }
    return $this;
  }

  public function getParentRule()
  {
    return $this-&gt;parentRule;
  }
  public function setParentRule(Rule $rule)
  {
    $this-&gt;parentRule = $rule;
  }

  /**
   * Split shorthand declarations (e.g. +margin+ or +font+) into their constituent parts.
   *
   * @return $this
   **/
  public function expandShorthands()
  {
    $expander = new StyleDeclaration\ExpandShorthands($this);
    $expander-&gt;expandShorthands();

    return $this;
  }

  /**
   * Convert shorthand font declarations
   * (e.g. &lt;tt&gt;font: 300 italic 11px/14px verdana, helvetica, sans-serif;&lt;/tt&gt;)
   * into their constituent parts.
   *
   * @return $this
   **/
  public function expandFontShorthands()
  {
    $expander = new StyleDeclaration\ExpandShorthands($this);
    $expander-&gt;expandFontShorthands();

    return $this;
  }

  /*
   * Convert shorthand background declarations
   * (e.g. &lt;tt&gt;background: url(&quot;chess.png&quot;) gray 50% repeat fixed;&lt;/tt&gt;)
   * into their constituent parts.
   * @see http://www.w3.org/TR/CSS21/colors.html#propdef-background
   *
   * @return $this
   **/
  public function expandBackgroundShorthands()
  {
    $expander = new StyleDeclaration\ExpandShorthands($this);
    $expander-&gt;expandBackgroundShorthands();

    return $this;
  }

  /**
   * Split shorthand border declarations (e.g. &lt;tt&gt;border: 1px red;&lt;/tt&gt;)
   * Additional splitting happens in expandDimensionsShorthand
   * Multiple borders are not yet supported as of CSS3
   *
   * @return $this
   **/
  public function expandBorderShorthands()
  {
    $expander = new StyleDeclaration\ExpandShorthands($this);
    $expander-&gt;expandBorderShorthands();

    return $this;
  }

  /**
   *
   * @return $this
   **/
  public function expandListStyleShorthands()
  {
    $expander = new StyleDeclaration\ExpandShorthands($this);
    $expander-&gt;expandListStyleShorthands();

    return $this;
  }

  /**
   * Split shorthand dimensional declarations (e.g. &lt;tt&gt;margin: 0px auto;&lt;/tt&gt;)
   * into their constituent parts.
   * Handles margin, padding, border-color, border-style and border-width.
   *
   * @params boolean $cleanup Whether to remove unused properties
   * @return $this
   **/
  public function expandDimensionsShorthands()
  {
    $expander = new StyleDeclaration\ExpandShorthands($this);
    $expander-&gt;expandDimensionsShorthands();

    return $this;
  }

  /**
   * Create shorthand declarations (e.g. +margin+ or +font+) whenever possible.
   *
   * @return $this
   **/
  public function createShorthands()
  {
    $creator = new StyleDeclaration\CreateShorthands($this);
    $creator-&gt;createShorthands();

    return $this;
  }

  public function createBackgroundShorthand()
  {
    $creator = new StyleDeclaration\CreateShorthands($this);
    $creator-&gt;createBackgroundShorthand();

    return $this;
	}

  public function createListStyleShorthand()
  {
    $creator = new StyleDeclaration\CreateShorthands($this);
    $creator-&gt;createListStyleShorthand();

    return $this;
	}

  /**
   * Combine border-color, border-style and border-width into border
   * Should be run after createDimensionsShorthand()
   *
   * @return $this
   **/
  public function createBorderShorthand()
  {
    $creator = new StyleDeclaration\CreateShorthands($this);
    $creator-&gt;createBorderShorthand();

    return $this;
  }

  /**
   * Looks for long format Css dimensional properties
   * (margin, padding, border-color, border-style and border-width) 
   * and converts them into shorthand Css properties.
   *
   * @return $this
   **/
  public function createDimensionsShorthands()
  {
    $creator = new StyleDeclaration\CreateShorthands($this);
    $creator-&gt;createDimensionsShorthands();

    return $this;
  }

  /**
   * Looks for long format Css font properties (e.g. &lt;tt&gt;font-weight&lt;/tt&gt;) and 
   * tries to convert them into a shorthand Css &lt;tt&gt;font&lt;/tt&gt; property. 
   * At least font-size AND font-family must be present in order to create a shorthand declaration.
   *
   * @return $this
   **/
  public function createFontShorthand()
  {
    $creator = new StyleDeclaration\CreateShorthands($this);
    $creator-&gt;createFontShorthand();

    return $this;
	}

  public function getCssText($options=array())
	{
		$indent = '';
		$nl = ' ';
		if(isset($options['indent_level'])) {
			$indent = str_repeat($options['indent_char'], $options['indent_level']);
			$nl = &quot;\n&quot;;
		}
    return implode($nl, array_map(function($property) use($indent, $options)
    {
      return $indent . $property-&gt;getCssText($options);
    }, $this-&gt;properties));
  }
  public function __toString()
  {
    return $this-&gt;getCssText();
  }

  public function __clone()
  {
    $this-&gt;properties = array_map(function($item)
    {
      return clone($item);
    }, $this-&gt;properties);
  }
}
</pre>
        <script type="text/javascript">
             SyntaxHighlighter.all()
             jQuery('.gutter div').each(function(key, data){
                jQuery(data).prepend('<a name="L'+jQuery(data).text()+'"/>');
             });
        </script>
    </body>
</html>