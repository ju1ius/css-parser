<html>
    <head>
        <script
            type="text/javascript"
            src="../../../js/jquery-1.4.2.min.js">
        </script>
        <script
            type="text/javascript"
            src="../../../syntax_highlighter/scripts/shCore.js">
        </script>
        <script
            type="text/javascript"
            src="../../../syntax_highlighter/scripts/shBrushJScript.js">
        </script>
        <script
            type="text/javascript"
            src="../../../syntax_highlighter/scripts/shBrushPhp.js">
        </script>
        <script
            type="text/javascript"
            src="../../../syntax_highlighter/scripts/shBrushXml.js">
        </script>
        <link
            href="../../../syntax_highlighter/styles/shCore.css" rel="stylesheet"
            type="text/css"
        />
        <link
            href="../../../syntax_highlighter/styles/shCoreEclipse.css"
            rel="stylesheet" type="text/css"
        />
        <link
            href="../../../syntax_highlighter/styles/shThemeWordpress.css"
            rel="stylesheet" type="text/css"
        />
    </head>
    <body>
        <pre class="brush: php">&lt;?php
namespace ju1ius\Css\Value;

use ju1ius\Css\Util;

/**
 * @package Css
 * @subpackage Value
 **/
class Color extends PrimitiveValue
{
  private
    $channels = array(
      'r' =&gt; 0, 'g' =&gt; 0, 'b' =&gt; 0 
    ),
    $mode;

  /**
   * @param mixed $color Can be an hex color string, an x11 color name,
   *                     or an array of rgb(a) or hsl(a) channels;
   *
   * @example $c = new Color(array('h' =&gt; 120, 's' =&gt; '50%', 'l' =&gt; '50%', 'a' =&gt; 0.8));
   **/
  public function __construct($color=null)
  {
    if(is_array($color)) {
      if(isset($color['r'], $color['g'], $color['b'])) {
        $this-&gt;fromRgb($color);
      } else if(isset($color['h'], $color['s'], $color['l'])) {
        $this-&gt;fromHsl($color);
      }
    } else if(is_string($color)) {
      if($rgb = Util\Color::x11ToRgb($color)) {
        $this-&gt;fromRgb($rgb);
      } else if($rgb = Util\Color::hexToRgb($color)) {
        $this-&gt;fromRgb($rgb);
      }
    }
  }

  public function getMode()
  {
    return $this-&gt;mode;
  }

  public function fromRgb(Array $rgb)
  {
    $mode = 'rgb';
    foreach($rgb as $channel =&gt; $value) {
      if($channel === 'a') {
				$value = Util\Color::constrainValue((string)$value, 0, 1);
				if($value === 1) continue;
				$mode .= 'a';
			} else {
				$value = Util\Color::normalizeRgbValue((string)$value);
			}
      $this-&gt;channels[$channel] = new Dimension($value);
    }
		$this-&gt;mode = $mode;
    return $this;
  }

  public function fromHsl(Array $hsl)
  {
    $rgb = Util\Color::hslToRgb(
			(string)$hsl['h'],
			(string)$hsl['s'],
			(string)$hsl['l'],
      isset($hsl['a']) ? (string)$hsl['a'] : 1
    );
    return $this-&gt;fromRgb($rgb);
  }

  public function fromHex($value)
  {
    $rgb = Util\Color::hexToRgb($value);
    return $this-&gt;fromRgb($rgb);
  }

  public function fromX11($value)
  {
    $rgb = Util\Color::x11ToRgb($value);
    return $this-&gt;fromRgb($rgb);
  }

  public function toRgb()
  {
    $mode = $this-&gt;mode;
    $channels = $this-&gt;channels;
    
    if(!$mode || $mode === 'rgb') return;
    if($mode === 'rgba') {
      // If we don't need alpha channel, drop it
      if($channels['a']-&gt;getValue() &gt;= 1) {
        unset($this-&gt;channels['a']);
        $this-&gt;mode = 'rgb';
      }
      return;
    }
    $rgb = Util\Color::hslToRgb(
      $channels['h']-&gt;getValue(),
      $channels['s']-&gt;getValue(),
      $channels['l']-&gt;getValue(),
      isset($channels['a']) ? $channels['a']-&gt;getValue() : 1
    );
		
    $this-&gt;channels = array();
    foreach($rgb as $key =&gt; $val) {
      $this-&gt;channels[$key] = new Dimension($val);
    }
    $this-&gt;mode = isset($rgb['a']) ? 'rgba' : 'rgb';
    return $this;
  }

  public function toHsl()
  {
    $mode = $this-&gt;mode;
    $channels = $this-&gt;channels;

    if(!$mode || $mode == 'hsl') return;
    if($mode == 'hsla') {
      // If we don't need alpha channel, drop it
      if($channels['a']-&gt;getValue() &gt;= 1) {
        unset($this-&gt;channels['a']);
        $this-&gt;mode = 'hsl';
      }
      return;
    }
    $hsl = Util\Color::rgb2hsl(
      $channels['r']-&gt;getValue(),
      $channels['g']-&gt;getValue(),
      $channels['b']-&gt;getValue(),
      isset($channels['a']) ? $channels['a']-&gt;getValue() : 1
    );
    $this-&gt;channels = array();
    $this-&gt;channels['h'] = new Dimension($hsl['h']);
    $this-&gt;channels['s'] = new Percentage($hsl['s']);
    $this-&gt;channels['l'] = new Percentage($hsl['l']);
		$this-&gt;mode = 'hsl';
    if(isset($hsl['a'])) {
      $this-&gt;channels['a'] = new Dimension($hsl['a']);
      $this-&gt;mode = 'hsla';
		}
    return $this;
  }

  public function getX11Color()
  {
    $channels = $this-&gt;channels;
    if(isset($channels['a']) &amp;&amp; $channels['a']-&gt;getValue() !== 1) return null;

    if($this-&gt;mode == 'rgb') {
      return Util\Color\rgbToX11(
        $channels['r']-&gt;getValue(),
        $channels['g']-&gt;getValue(),
        $channels['b']-&gt;getValue()
      );
    } else if ($this-&gt;mode == 'hsl') {
      return Util\Color::hslToX11(
        $channels['h']-&gt;getValue(),
        $channels['s']-&gt;getValue(),
        $channels['l']-&gt;getValue()
      );
    }
  }

  public function getHexValue()
  {
    $channels = $this-&gt;channels;
    if(isset($channels['a']) &amp;&amp; $channels['a']-&gt;getValue() !== 1) return null;

    if($this-&gt;mode === 'rgb') {
      return Util\Color::rgbToHex(
        $channels['r']-&gt;getValue(),
        $channels['g']-&gt;getValue(),
        $channels['b']-&gt;getValue()
      );
    } else if($this-&gt;mode === 'hsl') {
      return Util\Color::hslToX11(
        $channels['h']-&gt;getValue(),
        $channels['s']-&gt;getValue(),
        $channels['l']-&gt;getValue()
      );
    }
  }

  public function getCssText($options=array())
  {
		if(isset($options['color_mode'])) {
			switch($options['color_mode']) {
				case 'hex':
					if($value = $this-&gt;getHexValue()) return $value;
					break;
				case 'X11':
					if($value = $this-&gt;getX11Color()) return $value;
					break;
				case 'rgb':
				case 'rgba':
					$this-&gt;toRgb();
					break;
				case 'hsl':
				case 'hsla':
					$this-&gt;toHsl();
					break;
			}
		}
    return $this-&gt;mode.'('.implode(',', $this-&gt;channels).')';
  }

  public function __clone()
  {
    foreach($this-&gt;channels as $key =&gt; $value)
    {
      $this-&gt;channels[$key] = clone $value;
    }
  }
}
</pre>
        <script type="text/javascript">
             SyntaxHighlighter.all()
             jQuery('.gutter div').each(function(key, data){
                jQuery(data).prepend('<a name="L'+jQuery(data).text()+'"/>');
             });
        </script>
    </body>
</html>